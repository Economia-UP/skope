name: Run R Scripts Every 5 Minutes

on:
  schedule:
    - cron: '*/5 * * * *'  # This will run the workflow every 5 minutes.
  workflow_dispatch:  # Allow manual triggers as well.

jobs:
  run-r-scripts:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Step 2: Check if R is installed
      - name: Check if R is installed
        run: |
          if ! command -v R &> /dev/null
          then
            echo "R is not installed. Installing R..."
            sudo apt update
            sudo apt install -y r-base
          else
            echo "R is already installed."
          fi

      # Step 3: Set up R (in case additional setup is needed)
      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      # Step 4: Install required R packages only if not already installed
      - name: Install dependencies
        run: |
          Rscript -e "
          packages <- c('dplyr', 'ggplot2', 'tidyr')  # Modify this with the required packages
          installed <- installed.packages()[, 'Package']
          to_install <- packages[!(packages %in% installed)]
          if(length(to_install) > 0) {
            install.packages(to_install)
          }
          "

      # Step 5: Run R scripts from the 'R' folder
      - name: Run R scripts
        run: |
          for file in R/*.R; do
            # Run each script, assuming the script saves its output as a CSV in Out folder
            Rscript $file  # Modify the scripts to save CSV to MX/ folder

            # Example to save outputs from each R script:
            # Rscript $file > MX/$(basename $file .R).csv
          done
