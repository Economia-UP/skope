name: Run R Scripts Every 5 Minutes

on:
  schedule:
    - cron: '*/5 * * * *'  # This will run the workflow every 5 minutes.
  workflow_dispatch:  # Allow manual triggers as well.

jobs:
  run-r-scripts:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Step 2: Set up R
      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      # Step 3: Install required R packages only if not already installed
      - name: Install dependencies
        run: |
          Rscript -e "
          packages <- c('dplyr', 'ggplot2', 'tidyr', 'inegiR', 'siebanxicor', 'purrr')  # Modify this with the required packages
          installed <- installed.packages()[, 'Package']
          to_install <- packages[!(packages %in% installed)]
          if(length(to_install) > 0) {
            install.packages(to_install)
          }
          "

      # Step 4: Run R scripts from the 'R' folder
      - name: Run R scripts
        run: |
          for file in R/*.R; do
            # Run each script, assuming the script saves its output as a CSV in Out folder
            Rscript $file  # Modify the scripts to save CSV to MX/ folder

            # Example to save outputs from each R script:
            # Rscript $file > MX/$(basename $file .R).csv
          done
